<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bitanem İçin</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:ital,wght@1,600&display=swap');
        :root { --red: #8e0e0e; --gold: #d4af37; --white: #f8f9fa; --bg: #050508; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--white); font-family: 'Inter', sans-serif; height: 100vh; width: 100vw; overflow: hidden; position: fixed; }
        .bg-overlay { position: fixed; inset: 0; background: radial-gradient(circle, #1a0b0b 0%, #050508 100%); z-index: -2; }
        canvas { position: fixed; inset: 0; pointer-events: none; }
        .scene { position: absolute; inset: 0; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 30px; z-index: 10; opacity: 0; transition: opacity 2s ease; }
        .scene.active { display: flex; opacity: 1; }
        #timer { font-size: 3.5rem; font-weight: 300; color: var(--gold); margin-bottom: 20px; }
        #live-sub { font-family: 'Playfair Display'; color: var(--gold); font-size: 1.2rem; min-height: 1.5em; transition: 0.8s; opacity: 0; }
        .letter-content { display: none; background: #fff; color: #333; padding: 25px; border-radius: 8px; font-family: 'Playfair Display'; width: 85%; max-width: 320px; border: 1px solid var(--gold); cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.5); line-height: 1.6; }
        .wrapped-card { background: rgba(255, 255, 255, .05); backdrop-filter: blur(15px); border-radius: 20px; padding: 40px; width: 85%; max-width: 350px; border: 1px solid rgba(255,255,255,0.1); }
        .wrapped-val { font-size: 2.5rem; color: var(--gold); margin-top: 20px; display: block; font-weight: 600; }
        .btn { padding: 16px 40px; border-radius: 50px; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; }
        #btn-no { position: fixed; background: transparent; color: white; border: 1px solid rgba(255,255,255,.3); z-index: 1000; }
        #entry-gate { position: fixed; inset: 0; background: black; z-index: 10000; display: flex; justify-content: center; align-items: center; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.1); } }
    </style>
</head>
<body>

<audio id="love-music" loop>
    <source src="https://cdn.pixabay.com/audio/2022/05/27/audio_1808f3030e.mp3" type="audio/mpeg">
</audio>

<div id="entry-gate">
    <button class="btn" style="background:var(--red); color:white" onclick="startExperience()">Senin İçin Bir Şeyim Var ✨</button>
</div>

<div class="bg-overlay"></div>
<canvas id="snow"></canvas>
<canvas id="confetti"></canvas>

<section id="s-intro" class="scene">
    <h2 style="font-family:'Playfair Display'; font-weight:300; line-height:1.6;">
        Bu hikâye Bitanem için yazıldı...<br>
        <span style="font-size: 0.8rem; opacity:0.6; letter-spacing:3px;">ve sadece ona ait.</span>
    </h2>
</section>

<section id="s-count" class="scene">
    <p style="opacity:.5; margin-bottom:10px; letter-spacing: 5px; font-size: 0.7rem;">YENİ YILA KALAN</p>
    <div id="timer">00:00:00</div>
    <div id="live-sub">Birlikte yeni bir yıla...</div>
</section>

<section id="s-letter" class="scene">
    <div class="letter-content" id="let-paper" onclick="handleLetterClick()"></div>
    <p id="letter-hint" style="margin-top:20px; opacity:0.5; font-style:italic;">Okumak için dokun...</p>
</section>

<section id="s-bridge" class="scene">
    <h2 id="bridge-text" style="font-family:'Playfair Display'; font-weight: 400;"></h2>
</section>

<section id="s-wrapped" class="scene"></section>

<section id="s-silence" class="scene">
    <p style="font-size:1.2rem; letter-spacing:4px; opacity:0.7;">Hazır mısın?</p>
</section>

<section id="s-prop" class="scene">
    <h2 style="font-family:'Playfair Display'; font-size: 1.6rem; line-height: 1.4;">
        Herkes yeni yıla giriyor...<br>
        <span style="color:var(--gold)">Peki sen benim yıllarıma girmek ister misin?</span>
    </h2><br>
    <button class="btn" style="background:white; color:black; font-size: 1.1rem; box-shadow: 0 0 20px rgba(255,255,255,0.3);" onclick="finalYes()">SONSUZA KADAR EVET</button>
    <button id="btn-no" class="btn">Hayır</button>
</section>

<section id="s-final" class="scene">
    <h1 style="font-size: 5rem; margin-bottom: 20px; animation: pulse 1s infinite alternate;">❤️</h1>
    <h2 style="font-family:'Playfair Display'; line-height:1.8; padding: 0 20px;">
        SENİ ÇOK SEVİYORUM!<br>
        <span style="font-size: 1.1rem; font-weight: 300; opacity: 0.9;">
            İyi ki benimlesin, iyi ki varsın bitanem.<br>
            Hoş geldin 2025... Bizim yılımız olsun!
        </span>
    </h2>
</section>

<script>
    // Firebase Ayarları
    const firebaseConfig = {
        apiKey: "AIzaSyBwa-t-_rUBabzgDB5Ih5PCK8e2Ki3AarM",
        authDomain: "sunucu-dd652.firebaseapp.com",
        databaseURL: "https://sunucu-dd652-default-rtdb.firebaseio.com",
        projectId: "sunucu-dd652",
        storageBucket: "sunucu-dd652.firebasestorage.app",
        messagingSenderId: "487547465982",
        appId: "1:487547465982:web:f12f462aab224d01a775af"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let targetDate = new Date("2026-01-01T00:00:00").getTime();
    let letterStep = 0;
    const subs = ["Bir mesajla başladı...", "Sonra her anım oldu...", "Şimdi yeni bir yıla giriyoruz..."];
    let subIdx = 0;

    function startExperience() {
        document.getElementById('entry-gate').style.display = 'none';
        initSnow();
        document.getElementById('s-intro').style.display = 'flex';
        setTimeout(() => document.getElementById('s-intro').classList.add('active'), 100);
        setTimeout(() => changeScene('s-intro', 's-count'), 5000);
    }

    function finalYes() {
        const music = document.getElementById('love-music');
        music.play().catch(e => console.log("Müzik için etkileşim gerekiyor."));
        launchConfetti();
        changeScene('s-prop', 's-final');
        db.ref('cevaplar').push({ cevap: "EVET!", tarih: Date.now() });
    }

    setInterval(() => {
        const diff = targetDate - Date.now();
        const timerEl = document.getElementById('timer');
        if (diff <= 0) {
            timerEl.textContent = "00:00:00";
            if (document.getElementById('s-count').classList.contains('active')) {
                launchConfetti();
                setTimeout(() => changeScene('s-count', 's-letter'), 3000);
            }
        } else {
            const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
            const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
            const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
            timerEl.textContent = `${h}:${m}:${s}`;
            
            if (Date.now() % 4000 < 50) {
                const subEl = document.getElementById('live-sub');
                subEl.style.opacity = 0;
                setTimeout(() => {
                    subEl.innerText = subs[subIdx % subs.length];
                    subEl.style.opacity = 1;
                    subIdx++;
                }, 800);
            }
        }
    }, 1000);

    function handleLetterClick() {
        const paper = document.getElementById('let-paper');
        if (letterStep === 0) {
            paper.innerHTML = "İyi ki sana duygularımı söylemişim, iyi ki Aleyna bana o gün 'yaz' demiş, ben sana o gün yazmışım. Kader mi bilmiyorum ama çok mutluyum, umarım sen de mutlusundur. Seni ÇOOOOOOOOOOOOK SEVİYORUM BİTANEMMM! <br><br> <small style='color:var(--gold)'>(Devamı için dokun...)</small>";
            paper.style.display = 'block';
            letterStep = 1;
        } else {
            changeScene('s-letter', 's-bridge');
            runBridge();
        }
    }

    function runBridge() {
        const texts = ["Bazı insanlar bir anda girer hayatına...", "Bazılarıysa kalır."];
        let bIdx = 0;
        const el = document.getElementById('bridge-text');
        function next() {
            if (bIdx < texts.length) {
                el.style.opacity = 0;
                setTimeout(() => {
                    el.innerText = texts[bIdx];
                    el.style.opacity = 1;
                    bIdx++;
                    setTimeout(next, 3500);
                }, 1000);
            } else {
                changeScene('s-bridge', 's-wrapped');
                runWrapped();
            }
        }
        next();
    }

    function runWrapped() {
        const data = [
            {t: "2025'in en çok konuşulanı", v: "Biz"},
            {t: "Gülüşünü izleme saati", v: "∞"},
            {t: "BREAK", v: "Ama bazı şeyler sayıyla anlatılmaz..."},
            {t: "En güzel alışkanlığım", v: "Sesin"},
            {t: "2025'in en güzel hediyesi", v: "Sana sarılmak"}
        ];
        let idx = 0;
        const sw = document.getElementById('s-wrapped');
        function step() {
            if (idx >= data.length) {
                changeScene('s-wrapped', 's-silence');
                setTimeout(() => changeScene('s-silence', 's-prop'), 3000);
                return;
            }
            sw.innerHTML = data[idx].t === "BREAK" ? 
                `<h2 style="font-family:'Playfair Display'; padding:30px;">${data[idx].v}</h2>` :
                `<div class="wrapped-card"><p style="opacity:0.5; font-size:0.7rem;">HİKAYEMİZ</p><h3 style="margin:20px 0; font-weight:400;">${data[idx].t}</h3><span class="wrapped-val">${data[idx].v}</span></div>`;
            idx++;
            setTimeout(step, 4000);
        }
        step();
    }

    function changeScene(oldS, newS) {
        const o = document.getElementById(oldS);
        const n = document.getElementById(newS);
        if(!o || !n) return;
        o.classList.remove('active');
        setTimeout(() => {
            o.style.display = 'none';
            n.style.display = 'flex';
            setTimeout(() => n.classList.add('active'), 100);
            if(newS === 's-letter' && letterStep === 0) handleLetterClick();
        }, 2000);
    }

    function initSnow() {
        const c = document.getElementById('snow'), ctx = c.getContext('2d');
        c.width = innerWidth; c.height = innerHeight;
        const flakes = Array.from({ length: 100 }, () => ({ x: Math.random() * c.width, y: Math.random() * c.height, r: Math.random() * 2 + 1, d: Math.random() + 0.3 }));
        function draw() {
            ctx.clearRect(0, 0, c.width, c.height); ctx.fillStyle = "white"; ctx.beginPath();
            flakes.forEach(f => { ctx.moveTo(f.x, f.y); ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2); f.y += f.d; if (f.y > c.height) f.y = -10; });
            ctx.fill(); requestAnimationFrame(draw);
        }
        draw();
    }

    function launchConfetti() {
        const c = document.getElementById('confetti'), ctx = c.getContext('2d');
        c.width = innerWidth; c.height = innerHeight;
        const particles = Array.from({ length: 150 }, () => ({ x: Math.random() * c.width, y: -20, r: Math.random() * 4 + 2, d: Math.random() * 5 + 2, color: `hsl(${Math.random() * 360}, 80%, 60%)` }));
        function draw() {
            ctx.clearRect(0, 0, c.width, c.height);
            particles.forEach(p => { ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); ctx.fill(); p.y += p.d; });
            if (particles.length > 0 && particles[0].y < c.height + 100) requestAnimationFrame(draw);
        }
        draw();
    }

    const btnNo = document.getElementById('btn-no');
    const moveNo = (e) => {
        if(e) e.preventDefault();
        btnNo.style.left = Math.random() * (window.innerWidth - 100) + 'px';
        btnNo.style.top = Math.random() * (window.innerHeight - 50) + 'px';
    };
    btnNo.onmouseover = moveNo;
    btnNo.addEventListener('touchstart', moveNo);

</script>
</body>
</html>
