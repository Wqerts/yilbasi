<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yƒ±lba≈üƒ± S√ºrprizi</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;600&family=Playfair+Display:ital,wght@1,700&display=swap');

        :root { --red: #d62828; --gold: #f7b731; --bg: #050505; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; }

        /* YOƒûUN KAR EFEKTƒ∞ */
        .snow { position: absolute; background: white; border-radius: 50%; pointer-events: none; z-index: 100; filter: blur(1px); }

        /* SAHNELER - √áakƒ±≈ümayƒ± √ñnleyen Yapƒ± */
        .scene {
            position: absolute; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px; z-index: 10;
        }
        .active { display: flex; animation: fadeIn 1.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(1.05); } to { opacity: 1; transform: scale(1); } }

        /* CANLI ALTYAZI */
        #live-subtitle {
            position: fixed; bottom: 10%; width: 100%; text-align: center;
            font-size: 1.5rem; font-family: 'Playfair Display'; color: var(--gold);
            text-shadow: 0 0 15px rgba(247, 183, 49, 0.5); z-index: 200; opacity: 0; transition: 0.8s;
        }

        /* WRAPPED KARTLARI */
        .wrapped-card {
            background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 25px;
            padding: 40px; width: 85%; max-width: 350px; position: absolute;
            opacity: 0; transform: translateY(50px); transition: 0.8s;
        }
        .active-card { opacity: 1; transform: translateY(0); }

        /* TEKLƒ∞F MEN√úS√ú */
        .proposal-box { background: linear-gradient(135deg, #d62828 0%, #000 100%); padding: 50px 30px; border-radius: 40px; border: 2px solid var(--gold); }
        .btn { padding: 15px 35px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; margin: 10px; transition: 0.3s; }
        #btn-yes { background: var(--gold); color: black; font-size: 1.1rem; box-shadow: 0 0 20px var(--gold); }
        #btn-no { background: transparent; color: white; border: 1px solid white; position: absolute; }

        /* ADMIN PANEL */
        #admin-panel { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.9); padding: 10px; z-index: 1000; display: none; font-size: 11px; border-bottom: 1px solid var(--red); }
        input { background: #222; border: 1px solid #444; color: white; padding: 5px; border-radius: 5px; width: 150px; }
    </style>
</head>
<body>

    <div id="admin-panel">
        <input type="text" id="admin-sub" placeholder="Altyazƒ± g√∂nder...">
        <button onclick="sendSub()">G√∂nder</button> |¬†
        <button onclick="db.ref('testMode').set(Date.now())">Kilidi A√ß</button> |
        Aktif: <span id="user-count">0</span>
    </div>

    <div id="live-subtitle"></div>

    <div id="scene-countdown" class="scene active">
        <h1 id="timer" style="font-size: 4rem; color: var(--gold); font-weight: 200;">00:00:00</h1>
        <p style="letter-spacing: 3px; opacity: 0.6; margin-top: 10px;">YENƒ∞ YILA VE Bƒ∞ZE DOƒûRU</p>
    </div>

    <div id="scene-letter" class="scene">
        <div style="background:white; color:#111; padding:40px; border-radius:5px; width:300px; font-family:'Playfair Display'; position:relative;">
            <div id="letter-msg">Seninle her ≈üey daha anlamlƒ±...</div>
        </div>
        <button class="btn" onclick="transition('scene-letter', 'scene-wrapped')" style="background:var(--red); color:white; margin-top:30px;">Devam Et ‚ù§Ô∏è</button>
    </div>

    <div id="scene-wrapped" class="scene"></div>

    <div id="scene-proposal" class="scene">
        <div class="proposal-box">
            <h1 style="font-family:'Playfair Display'; margin-bottom:20px;">√ñmr√ºm olur musun?</h1>
            <div style="height:150px; position:relative; width:100%;">
                <button id="btn-yes" class="btn">EVET!</button>
                <button id="btn-no" class="btn">Hayƒ±r</button>
            </div>
        </div>
    </div>

    <div id="scene-final" class="scene">
        <h1 style="font-size: 5rem;">üéÑ‚ù§Ô∏è</h1>
        <h1 style="font-family:'Playfair Display';">Mutlu Yƒ±llar Sevgilim!</h1>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBwa-t-_rUBabzgDB5Ih5PCK8e2Ki3AarM",
            authDomain: "sunucu-dd652.firebaseapp.com",
            databaseURL: "https://sunucu-dd652-default-rtdb.firebaseio.com",
            projectId: "sunucu-dd652",
            storageBucket: "sunucu-dd652.firebasestorage.app",
            messagingSenderId: "487547465982",
            appId: "1:487547465982:web:f12f462aab224d01a775af"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Admin Kontrol√º
        if(window.location.search.includes('admin=1')) document.getElementById('admin-panel').style.display = 'block';

        // Saya√ß
        const uRef = db.ref('online').push();
        db.ref('.info/connected').on('value', s => { if(s.val()){ uRef.onDisconnect().remove(); uRef.set(true); }});
        db.ref('online').on('value', s => document.getElementById('user-count').innerText = s.numChildren());

        // Canlƒ± Altyazƒ± Fonksiyonu
        function sendSub() {
            const val = document.getElementById('admin-sub').value;
            db.ref('subtitle').set({ text: val, t: Date.now() });
        }

        db.ref('subtitle').on('value', snap => {
            const data = snap.val();
            if(data) {
                const sub = document.getElementById('live-subtitle');
                sub.innerText = data.text;
                sub.style.opacity = 1;
                setTimeout(() => sub.style.opacity = 0, 4000);
            }
        });

        // Sahne Ge√ßi≈ü Fonksiyonu
        function transition(from, to) {
            document.getElementById(from).classList.remove('active');
            setTimeout(() => {
                document.getElementById(to).classList.add('active');
                if(to === 'scene-wrapped') startWrapped();
            }, 100);
        }

        // Wrapped Mantƒ±ƒüƒ± (7 Kart)
        function startWrapped() {
            const container = document.getElementById('scene-wrapped');
            const cards = [
                "Tanƒ±≈ütƒ±ƒüƒ±mƒ±z o ilk g√ºn...", "G√ºl√º≈ü√ºnle d√ºnyamƒ± aydƒ±nlattƒ±ƒüƒ±n o an.",
                "En sevdiƒüimiz ≈üarkƒ± ba≈üladƒ±ƒüƒ±nda...", "Beraber kurduƒüumuz hayaller.",
                "Her zorlukta yan yana duru≈üumuz.", "Seninle ge√ßen her saniye bir hazine.",
                "Ve ≈üimdi yeni bir yƒ±la el ele giriyoruz."
            ];
            cards.forEach((text, i) => {
                const c = document.createElement('div');
                c.className = 'wrapped-card';
                c.id = `card-${i}`;
                c.innerHTML = `<p>${text}</p>`;
                container.appendChild(c);
            });

            let idx = 0;
            function next() {
                if(idx > 0) document.getElementById(`card-${idx-1}`).classList.remove('active-card');
                if(idx < cards.length) {
                    document.getElementById(`card-${idx}`).classList.add('active-card');
                    idx++; setTimeout(next, 4000);
                } else {
                    setTimeout(() => transition('scene-wrapped', 'scene-proposal'), 1000);
                }
            }
            next();
        }

        // Kar Yaƒüƒ±≈üƒ± (Yoƒüunla≈ütƒ±rƒ±lmƒ±≈ü)
        function createSnow() {
            const s = document.createElement('div');
            s.className = 'snow';
            const size = Math.random() * 5 + 2 + 'px';
            s.style.width = size; s.style.height = size;
            s.style.left = Math.random() * 100 + 'vw';
            s.style.top = '-10px';
            s.style.opacity = Math.random();
            const duration = Math.random() * 3 + 2 + 's';
            document.body.appendChild(s);
            s.animate([{ top: '-10px' }, { top: '100vh' }], { duration: parseFloat(duration) * 1000 });
            setTimeout(() => s.remove(), parseFloat(duration) * 1000);
        }
        setInterval(createSnow, 50); // Kar yoƒüunluƒüu burada!

        // Zamanlayƒ±cƒ±
        let targetDate = new Date(); targetDate.setHours(24,0,0,0);
        setInterval(() => {
            const diff = targetDate - new Date();
            if(diff <= 0) {
                if(document.getElementById('scene-countdown').classList.contains('active')) transition('scene-countdown', 'scene-letter');
            } else {
                const h = Math.floor(diff/3600000).toString().padStart(2,'0');
                const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('timer').innerText = `${h}:${m}:${s}`;
            }
        }, 1000);

        db.ref('testMode').on('value', () => targetDate = new Date());

        // Hayƒ±r Butonu Ka√ßƒ±≈üƒ±
        const bNo = document.getElementById('btn-no');
        bNo.onmouseover = () => {
            bNo.style.left = Math.random()*80 + '%';
            bNo.style.top = Math.random()*80 + '%';
        };
        document.getElementById('btn-yes').onclick = () => transition('scene-proposal', 'scene-final');

    </script>
</body>
</html>
