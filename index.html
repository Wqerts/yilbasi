<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sadece Senin İçin</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;500;700&display=swap');
        
        :root { --bg: #050510; --gold: #ffd700; --red: #e63946; }
        * { box-sizing: border-box; touch-action: manipulation; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: #f0f0f5; font-family: 'Montserrat', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        /* --- SAHNELER --- */
        .scene { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; opacity: 0; visibility: hidden; transition: opacity 1.5s ease; z-index: 10; }
        .scene.active { opacity: 1; visibility: visible; z-index: 20; }

        /* --- MEKTUP --- */
        .envelope-container { position: relative; width: 280px; height: 180px; background: #cfcfcf; cursor: pointer; margin-bottom: 50px; }
        .envelope-flap { position: absolute; top: 0; left: 0; width: 0; height: 0; border-left: 140px solid transparent; border-right: 140px solid transparent; border-top: 100px solid #e0e0e0; transform-origin: top; transition: 0.6s; z-index: 5; }
        .envelope-body { position: absolute; bottom: 0; left: 0; width: 0; height: 0; border-left: 140px solid transparent; border-right: 140px solid transparent; border-bottom: 90px solid #d6d6d6; z-index: 4; }
        .letter-paper { position: absolute; bottom: 0; left: 20px; width: 240px; height: 160px; background: #fff; color: #333; padding: 15px; font-family: 'Playfair Display', serif; transition: 0.8s; z-index: 3; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
        .envelope-container.open .envelope-flap { transform: rotateX(180deg); z-index: 1; }
        .envelope-container.open .letter-paper { transform: translateY(-80px); z-index: 6; }

        /* --- WRAPPED KARTLARI --- */
        .wrapped-card { background: linear-gradient(135deg, #1db954, #1ed760); color: #000; width: 85%; max-width: 320px; padding: 30px; border-radius: 20px; position: absolute; transform: scale(0.8); opacity: 0; transition: 0.8s; }
        .wrapped-card.active-card { transform: scale(1); opacity: 1; z-index: 5; }

        /* --- BUTONLAR --- */
        button { padding: 15px 30px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #btn-yes { background: var(--red); color: white; }
        #btn-no { background: #555; color: white; position: absolute; }

        /* --- ADMIN PANEL --- */
        #admin-panel { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.85); color: #ffd700; padding: 10px; z-index: 9999; display: none; font-size: 12px; border-bottom: 1px solid var(--gold); }
        
        /* KAR EFEKTİ */
        .snow { position: absolute; background: white; border-radius: 50%; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }
    </style>
</head>
<body>

    <div id="admin-panel">
        <b>CANLI TAKİP:</b> <span id="status-log">Bağlanıyor...</span> | 
        <button style="padding:5px; font-size:10px;" onclick="db.ref('testMode').set(Date.now())">Kilidi Aç (Test)</button>
    </div>

    <div id="scene-countdown" class="scene active">
        <p>Bu hikâye doğru zamanı bekliyor…</p>
        <div id="timer" style="font-size: 3rem; color: var(--gold); font-weight: bold;">00:00:00</div>
    </div>

    <div id="scene-letter" class="scene">
        <div class="envelope-container" id="envelope">
            <div class="envelope-flap"></div>
            <div class="envelope-body"></div>
            <div class="letter-paper">Sana söylemek istediğim çok şey var ama en güzeli şu: İyi ki varsın...</div>
        </div>
        <p>Mektubun var, dokunup aç...</p>
    </div>

    <div id="scene-wrapped" class="scene"></div>

    <div id="scene-proposal" class="scene">
        <h1>Herkes yeni yıla...</h1>
        <h2>Sen yıllarıma girmek ister misin?</h2>
        <div style="position:relative; height:100px; width:100%;">
            <button id="btn-yes">EVET</button>
            <button id="btn-no">HAYIR</button>
        </div>
    </div>

    <div id="scene-final" class="scene">
        <h1 style="font-size: 4rem;">❤️</h1>
        <h1>Seni Seviyorum Bitanem</h1>
    </div>

    <script>
        // --- FIREBASE BAĞLANTISI ---
        const firebaseConfig = {
            apiKey: "AIzaSyBwa-t-_rUBabzgDB5Ih5PCK8e2Ki3AarM",
            authDomain: "sunucu-dd652.firebaseapp.com",
            databaseURL: "https://sunucu-dd652-default-rtdb.firebaseio.com",
            projectId: "sunucu-dd652",
            storageBucket: "sunucu-dd652.firebasestorage.app",
            messagingSenderId: "487547465982",
            appId: "1:487547465982:web:f12f462aab224d01a775af"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Admin Kontrolü (?admin=1)
        if(window.location.search.includes('admin=1')) document.getElementById('admin-panel').style.display = 'block';

        // Durum Gönder
        function logStatus(msg) {
            db.ref('userStatus').set({ action: msg, time: new Date().toLocaleTimeString() });
        }

        // Durum İzle (Admin için)
        db.ref('userStatus').on('value', snap => {
            const data = snap.val();
            if(data) document.getElementById('status-log').innerText = `${data.action} (${data.time})`;
        });

        // Test Modu İzle
        db.ref('testMode').on('value', () => { targetDate = new Date(); });

        // --- ZAMAN MANTIĞI ---
        let targetDate = new Date(); targetDate.setHours(24,0,0,0);
        setInterval(() => {
            const diff = targetDate - new Date();
            if(diff <= 0) {
                if(document.getElementById('scene-countdown').classList.contains('active')) {
                    transition('scene-countdown', 'scene-letter');
                    logStatus("Site Açıldı!");
                }
            } else {
                const h = Math.floor(diff/3600000).toString().padStart(2,'0');
                const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('timer').innerText = `${h}:${m}:${s}`;
            }
        }, 1000);

        // --- SAHNE GEÇİŞLERİ ---
        function transition(from, to) {
            document.getElementById(from).classList.remove('active');
            setTimeout(() => {
                document.getElementById(to).classList.add('active');
                if(to === 'scene-wrapped') startWrapped();
            }, 1000);
        }

        // --- MEKTUP ---
        document.getElementById('envelope').onclick = function() {
            this.classList.add('open');
            logStatus("Mektubu açtı");
            setTimeout(() => {
                document.body.onclick = () => { transition('scene-letter', 'scene-wrapped'); document.body.onclick = null; };
            }, 2000);
        };

        // --- WRAPPED ---
        function startWrapped() {
            logStatus("Wrapped izliyor");
            const container = document.getElementById('scene-wrapped');
            const stats = [
                {l:"Seninle Konuştuğumuz Gün", v:"42"}, // Burayı otomatik hesaplatabilirsin
                {l:"Kalbime Denk Gelme Oranı", v:"%100"},
                {l:"Seni Düşündüğüm Anlar", v:"Sayısız"}
            ];
            stats.forEach((s, i) => {
                const card = document.createElement('div');
                card.className = 'wrapped-card';
                card.id = `card-${i}`;
                card.innerHTML = `<p>${s.l}</p><h1 style="font-size:3rem">${s.v}</h1>`;
                container.appendChild(card);
            });
            let idx = 0;
            function next() {
                if(idx > 0) document.getElementById(`card-${idx-1}`).style.opacity = '0';
                if(idx < stats.length) {
                    document.getElementById(`card-${idx}`).classList.add('active-card');
                    idx++; setTimeout(next, 3500);
                } else {
                    setTimeout(() => transition('scene-wrapped', 'scene-proposal'), 1000);
                }
            }
            next();
        }

        // --- HAYIR BUTONU KAÇIŞ ---
        const btnNo = document.getElementById('btn-no');
        const btnYes = document.getElementById('btn-yes');
        let count = 0;
        btnNo.onmouseover = btnNo.onclick = () => {
            btnNo.style.left = Math.random()*80 + '%';
            btnNo.style.top = Math.random()*80 + '%';
            logStatus("Hayır'a basmaya çalışıyor: " + (++count));
            if(count >= 3) btnYes.style.transform = "scale(2)";
        };

        btnYes.onclick = () => {
            logStatus("EVET DEDİ! ❤️");
            transition('scene-proposal', 'scene-final');
            setInterval(createSnow, 100);
        };

        // --- KAR EFEKTİ ---
        function createSnow() {
            const s = document.createElement('div');
            s.className = 'snow';
            const size = Math.random()*5 + 'px';
            s.style.width = size; s.style.height = size;
            s.style.left = Math.random()*100 + 'vw';
            s.style.top = '-10px';
            s.style.animationDuration = Math.random()*3 + 2 + 's';
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 5000);
        }
        setInterval(createSnow, 300);
    </script>
</body>
</html>
