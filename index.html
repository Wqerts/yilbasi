<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sadece Senin İçin</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;500;700&display=swap');
        :root { --bg: #050510; --gold: #ffd700; --red: #e63946; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: #f0f0f5; font-family: 'Montserrat', sans-serif; overflow: hidden; transition: background 2s ease; }
        
        .scene { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; opacity: 0; visibility: hidden; transition: 1s; }
        .active { opacity: 1; visibility: visible; }

        /* ADMIN PANEL */
        #admin-panel { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.95); color: var(--gold); padding: 5px; z-index: 9999; display: none; font-size: 10px; border-bottom: 2px solid var(--red); }
        
        /* SPOT LIGHT */
        #spotlight { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 500; display: none; justify-content: center; align-items: center; font-size: 2.5rem; color: white; text-align: center; }

        /* HEYECAN ÖLÇER (ONUN EKRANI) */
        #mood-slider-box { position: fixed; bottom: 20%; width: 80%; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px; display: none; z-index: 100; backdrop-filter: blur(10px); }
        input[type=range] { width: 100%; }

        button { padding: 4px 8px; border-radius: 4px; border: none; cursor: pointer; font-size: 10px; margin: 2px; }
    </style>
</head>
<body id="main-body">

    <div id="admin-panel">
        <span id="user-count" style="background:red; color:white; padding:2px 5px;">0</span> |
        <input type="text" id="admin-sub" placeholder="Altyazı...">
        <button onclick="db.ref('subtitle').set({text: document.getElementById('admin-sub').value, t: Date.now()})">Altyazı</button>
        <button style="background:red; color:white;" onclick="db.ref('trigger').set({type:'vibrate', t:Date.now()})">Kalp Atışı</button>
        <button style="background:blue; color:white;" onclick="db.ref('trigger').set({type:'mood_ask', t:Date.now()})">Heyecan Sor</button>
        <button style="background:white;" onclick="db.ref('trigger').set({type:'spot', text:prompt('Kelime:'), t:Date.now()})">Spot</button>
        <button style="background:orange;" onclick="db.ref('trigger').set({type:'firework', t:Date.now()})">Havai Fişek</button>
        <button style="background:green; color:white;" onclick="db.ref('testMode').set(Date.now())">Aç</button>
        <div id="admin-info" style="color:white;"></div>
    </div>

    <div id="spotlight"></div>
    <div id="mood-slider-box">
        <p>Ne kadar heyecanlısın? ❤️</p>
        <input type="range" min="0" max="100" value="50" oninput="db.ref('mood_res').set({val: this.value})">
    </div>

    <div id="scene-countdown" class="scene active">
        <h1 id="timer" style="font-size: 3rem;">00:00:00</h1>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBwa-t-_rUBabzgDB5Ih5PCK8e2Ki3AarM",
            authDomain: "sunucu-dd652.firebaseapp.com",
            databaseURL: "https://sunucu-dd652-default-rtdb.firebaseio.com",
            projectId: "sunucu-dd652",
            storageBucket: "sunucu-dd652.firebasestorage.app",
            messagingSenderId: "487547465982",
            appId: "1:487547465982:web:f12f462aab224d01a775af"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        if(window.location.search.includes('admin=1')) document.getElementById('admin-panel').style.display = 'block';

        // PRESENCE & SAYAÇ
        const uRef = db.ref('online_users').push();
        db.ref('.info/connected').on('value', s => { if(s.val()){ uRef.onDisconnect().remove(); uRef.set(true); } });
        db.ref('online_users').on('value', s => { document.getElementById('user-count').innerText = s.numChildren(); });

        // TETİKLEYİCİLER
        db.ref('trigger').on('value', snap => {
            const d = snap.val(); if(!d) return;
            if(d.type === 'vibrate') { if(navigator.vibrate) navigator.vibrate([200, 100, 200]); }
            if(d.type === 'mood_ask') { document.getElementById('mood-slider-box').style.display = 'block'; }
            if(d.type === 'spot') {
                const s = document.getElementById('spotlight');
                s.innerText = d.text; s.style.display = 'flex';
                setTimeout(() => s.style.display = 'none', 4000);
            }
            if(d.type === 'firework') { /* Basit konfeti şovu tetiklenir */ }
        });

        // HEYECAN CEVABI TAKİP (SADECE ADMİNDE)
        db.ref('mood_res').on('value', snap => {
            if(document.getElementById('admin-panel').style.display === 'block') {
                document.getElementById('admin-info').innerText = "Heyecan Seviyesi: %" + snap.val().val;
            }
        });

        // ZAMANLAYICI (STANDART)
        let targetDate = new Date(); targetDate.setHours(24,0,0,0);
        setInterval(() => {
            const diff = targetDate - new Date();
            if(diff <= 0) {
                document.getElementById('scene-countdown').classList.remove('active');
            } else {
                const s = Math.floor(diff/1000);
                document.getElementById('timer').innerText = s; // Örnek saniye sayacı
            }
        }, 1000);

        db.ref('testMode').on('value', () => targetDate = new Date());
    </script>
</body>
</html>
